# 🔮 每日运势功能说明

## ✨ 功能介绍

在应用首页顶部显示基于玄学和星座理论的每日运势，包括AI生成的祝福语、幸运购买时间和运势原因，帮助用户选择最佳的购彩时机。

## 🎯 功能特点

### 1. AI生成祝福语
- 基于用户星座和生日
- 每日定制化祝福
- 充满正能量的吉祥话语

### 2. 幸运时间推荐
- 基于玄学理论计算
- 给出最佳购彩时段
- 实时显示是否在幸运时间内

### 3. 运势原因说明
- 基于星座运势理论
- 结合紫微斗数、八字命理
- 简要说明为什么这个时间幸运

## 🎨 界面设计

### 默认状态
```
┌──────────────────────────────────┐
│ 🔮 今日运势      [🔄]     │ ← 头部
│ 射手座专属                      │
│                                  │
│ ✨ 今日紫气东来，财运亨通，    │ ← 祝福语
│    万事如意！                   │
│                                  │
│ ┌────────────────────────────┐   │
│ │ 🕐 今日最佳购彩时间      │   │ ← 幸运时间
│ │ 09:00-11:00               │   │
│ └────────────────────────────┘   │
│                                  │
│ 📖 今日为贵人时，辰巳时     │ ← 运势原因
│    财运最旺，适合购买彩票      │
└──────────────────────────────────┘
```

### 幸运时间状态
```
┌──────────────────────────────────┐
│ 🌟 现在就是幸运时间！  🎯 │   │
│ 09:00-11:00                  │   │
└──────────────────────────────────┘
```
- 图标变为 🌟
- 文字变为"现在就是幸运时间！"
- 背景变为金色渐变
- 🎯 图标跳动提示

### 加载状态
```
┌──────────────────────────────────┐
│ 🔮 正在获取运势...          │   │
└──────────────────────────────────┘
```

### 错误状态
```
┌──────────────────────────────────┐
│ ⚠️ 获取运势失败    [🔄]  │   │
└──────────────────────────────────┘
```

## 🔧 技术实现

### 1. fortuneService 工具

#### getDailyFortune()
```typescript
async function getDailyFortune(
  zodiacSign: string,
  lotteryType: string,
  birthDate: string
): Promise<DailyFortune | null>
```

**功能**：
- 调用智谱AI生成运势
- 解析返回的JSON数据
- 返回祝福语、幸运时间、原因

#### isLuckyTime()
```typescript
function isLuckyTime(luckyTime: string): boolean
```

**功能**：
- 检查当前时间是否在幸运时段内
- 返回布尔值
- 用于实时更新UI状态

### 2. DailyFortune 组件

#### Props
```typescript
interface DailyFortuneProps {
  lotteryType: LotteryType;
}
```

#### 状态管理
```typescript
const [fortune, setFortune] = useState(null);
const [loading, setLoading] = useState(false);
const [error, setError] = useState(null);
const [zodiacSign, setZodiacSign] = useState('');
```

#### useEffect 钩子
```typescript
// 1. 计算星座
useEffect(() => {
  const birthDate = settings.birthDate;
  if (birthDate) {
    const sign = getZodiacSign(month, day);
    setZodiacSign(sign);
  }
}, [settings.birthDate]);

// 2. 获取运势
useEffect(() => {
  fetchDailyFortune();
}, [lotteryType, zodiacSign]);

// 3. 定时检查幸运时间
useEffect(() => {
  const interval = setInterval(() => {
    // 每分钟检查一次
  }, 60000);
  return () => clearInterval(interval);
}, [fortune?.luckyTime]);
```

## 📱 用户体验

### 初始加载
1. 用户打开首页
2. 自动显示加载状态
3. 调用AI获取运势
4. 显示完整的运势信息

### 实时更新
- 每分钟检查幸运时间状态
- 进入幸运时间时自动更新UI
- 离开幸运时间时恢复默认状态

### 手动刷新
- 点击右上角刷新按钮
- 重新获取今日运势
- 更新幸运时间信息

## 🎯 运势生成逻辑

### AI Prompt 设计
```typescript
你是专业的命理大师和星座运势专家。

要求：
1. 祝福语：1-2句吉祥祝福
2. 幸运时间：最佳购彩时段（HH:mm-HH:mm）
3. 幸运原因：玄学理论说明
4. 输出格式：JSON

输出示例：
{
  "blessing": "今日紫气东来，财运亨通！",
  "luckyTime": "09:00-11:00",
  "luckyHour": 10,
  "reason": "今日为贵人时，辰巳时财运最旺"
}
```

### 玄学理论来源

#### 星座运势
- 根据每日星座运势
- 结合幸运时段和幸运方位
- 推荐最佳行动时间

#### 紫微斗数
- 计算十二时辰
- 分析贵人时和桃花时
- 推荐财运最旺时段

#### 八字命理
- 基于日柱干支
- 分析日吉时
- 推荐适宜活动

## 🎨 颜色方案

### 主背景
- 渐变：紫色30% → 粉色30%
- 边框：紫色40%
- 圆角：xl

### 幸运时间（默认）
- 背景：紫色900/50
- 文字：白色（标题）、黄色300（时间）

### 幸运时间（激活）
- 背景：金色渐变（黄色400 → 橙色400）
- 文字：白色
- 图标：🌟 脉冲动画

### 加载状态
- 背景：紫色20% → 粉色20%
- 图标：🔮 旋转动画
- 文字：紫色200

### 错误状态
- 背景：紫色20% → 粉色20%
- 图标：⚠️
- 文字：紫色200
- 刷新按钮：紫色300 → 白色

## 💡 使用建议

### 1. 最佳使用时间
- 在推荐的幸运时段内购买彩票
- 提前准备好选号
- 关注实时状态更新

### 2. 运势解读
- 祝福语提供积极心理暗示
- 幸运时间基于传统玄学
- 运势原因了解背后逻辑

### 3. 结合其他功能
- 使用AI财神推荐号码
- 在幸运时间内购买
- 保存到历史记录

## 📊 功能状态

| 功能 | 状态 | 说明 |
|-----|------|------|
| AI祝福语生成 | ✅ 完成 | 智谱AI |
| 幸运时间推荐 | ✅ 完成 | 玄学理论 |
| 运势原因说明 | ✅ 完成 | 星座/八字 |
| 实时状态检测 | ✅ 完成 | 每分钟检测 |
| 幸运时间高亮 | ✅ 完成 | 动画效果 |
| 手动刷新功能 | ✅ 完成 | 一键刷新 |
| 加载状态显示 | ✅ 完成 | 动画提示 |
| 错误处理 | ✅ 完成 | 友好提示 |

## 🚀 性能优化

### API调用优化
- 缓存当日运势
- 避免重复调用
- 错误重试机制

### 渲染优化
- 条件渲染减少DOM
- CSS动画使用transform
- 定时器清理

### 状态管理
- 使用useState管理
- useEffect清理副作用
- 避免不必要的重渲染

## 💡 运势示例

### 双色球运势
```
🔮 今日运势 - 射手座专属

✨ 今日紫气东来，财运亨通，万事如意！

🕐 今日最佳购彩时间
   09:00-11:00

📖 今日为贵人时，辰巳时财运最旺，适合购买彩票
```

### 大乐透运势
```
🔮 今日运势 - 射手座专属

✨ 财星高照，鸿运当头，心想事成！

🕐 今日最佳购彩时间
   14:00-16:00

📖 今日为天德吉日，未时财运最旺，宜购彩博彩
```

## 🎯 后续优化方向

1. **更多玄学理论**
   - 添加黄道吉日
   - 集成宜忌查询
   - 添加财神方位

2. **更详细的运势**
   - 添加整体运势指数
   - 财运、事业、爱情运势
   - 幸运颜色和数字

3. **个性化推荐**
   - 根据八字定制
   - 结合流年运势
   - 个人专属建议

## 📱 响应式设计

- **桌面端**: 标准间距和字体
- **移动端**: 优化触摸体验
- **自适应**: 自动调整布局

## 🎉 总结

每日运势功能为用户提供了基于玄学理论的购彩时间建议，结合AI生成的祝福语和运势原因，让用户在选择购买时机时更有信心和参考。实时状态检测功能确保用户不会错过幸运时间。

希望你喜欢这个功能！🔮✨
