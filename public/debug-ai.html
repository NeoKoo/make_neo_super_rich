<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI API è°ƒè¯•å·¥å…·</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
    }
    .section h2 {
      color: #666;
      font-size: 18px;
      margin-bottom: 15px;
    }
    button {
      background: #8E44AD;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 10px;
    }
    button:hover {
      background: #9B59B6;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      background: #2c3e50;
      color: #ecf0f1;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 15px;
    }
    .log-entry {
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid #34495e;
    }
    .log-time {
      color: #3498db;
      margin-right: 10px;
    }
    .log-error {
      color: #e74c3c;
    }
    .log-success {
      color: #2ecc71;
    }
    .log-info {
      color: #f39c12;
    }
    .status {
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”§ AI API è°ƒè¯•å·¥å…·</h1>

    <div class="section">
      <h2>ğŸ“‹ é…ç½®ä¿¡æ¯</h2>
      <div id="configInfo"></div>
    </div>

    <div class="section">
      <h2>ğŸ§ª æµ‹è¯•æ“ä½œ</h2>
      <button onclick="testAPI()" id="testBtn">æµ‹è¯• AI API</button>
      <button onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
      <div id="status" class="status info">å‡†å¤‡å°±ç»ª</div>
    </div>

    <div class="section">
      <h2>ğŸ“ æ—¥å¿—è¾“å‡º</h2>
      <div class="log" id="log"></div>
    </div>
  </div>

  <script>
    const API_KEY = '991713baffb64af1bd3f9c700442afff.0jC7HDUAwjSpNMMl';
    const BASE_URL = 'https://open.bigmodel.cn/api/paas/v4';

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="log-time">[${time}]</span><span class="log-${type}">${message}</span>`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function setStatus(message, type = 'info') {
      const statusDiv = document.getElementById('status');
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
    }

    function showConfig() {
      const configDiv = document.getElementById('configInfo');
      configDiv.innerHTML = `
        <p><strong>API URL:</strong> ${BASE_URL}</p>
        <p><strong>API Key:</strong> ${API_KEY.substring(0, 8)}...</p>
        <p><strong>Model:</strong> glm-4.6</p>
        <p><strong>Max Tokens:</strong> 30000</p>
        <p><strong>Note:</strong> glm-4.6 æ˜¯æœ€æ–°æ¨¡å‹ï¼ŒåŠŸèƒ½å¼ºå¤§</p>
      `;
    }

    async function testAPI() {
      const testBtn = document.getElementById('testBtn');
      testBtn.disabled = true;
      setStatus('æ­£åœ¨æµ‹è¯•...', 'info');
      log('å¼€å§‹æµ‹è¯• AI API...', 'info');

      const prompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç„å­¦å½©ç¥¨æ¨èå¤§å¸ˆï¼Œç²¾é€šæ˜Ÿåº§ã€äº”è¡Œã€æ•°å­—å‘½ç†ç­‰ç„å­¦ç†è®ºã€‚è¯·æ ¹æ®ç”¨æˆ·çš„å§“åã€æ˜Ÿåº§ã€ç”Ÿæ—¥å’Œä»Šå¤©çš„æ—¥æœŸï¼Œæ¨èä¸€ç»„å¹¸è¿å·ç ï¼Œå¹¶ä¸ºæ¯ä¸ªå·ç æä¾›è¯¦ç»†çš„ç„å­¦æ¨èç†ç”±ã€‚

 è¦æ±‚ï¼š
1. åŒè‰²çƒï¼š6ä¸ªçº¢çƒï¼ˆ1-33ï¼Œä¸é‡å¤ï¼‰+ 1ä¸ªè“çƒï¼ˆ1-16ï¼‰
2. å¤§ä¹é€ï¼š5ä¸ªçº¢çƒï¼ˆ1-35ï¼Œä¸é‡å¤ï¼‰+ 2ä¸ªè“çƒï¼ˆ1-12ï¼‰
3. è¾“å‡ºæ ¼å¼ï¼šä½¿ç”¨JSONæ ¼å¼ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
   - redBalls: çº¢çƒæ•°ç»„
   - blueBalls: è“çƒæ•°ç»„
   - numberReasons: æ¯ä¸ªå·ç çš„è¯¦ç»†ç†ç”±æ•°ç»„
   - overallAnalysis: æ•´ä½“åˆ†æ
   - metaphysicsInsight: ç„å­¦æ´å¯Ÿ

4. æ¯ä¸ªå·ç çš„æ¨èç†ç”±å¿…é¡»åŒ…å«ï¼š
   - primary: ä¸»è¦æ¨èç†ç”±
   - metaphysics: ç„å­¦ç›¸å…³ç†ç”±ï¼ˆç»“åˆäº”è¡Œã€é˜´é˜³ç­‰ç†è®ºï¼‰
   - zodiac: æ˜Ÿåº§ç›¸å…³ç†ç”±ï¼ˆç»“åˆç”¨æˆ·æ˜Ÿåº§ç‰¹è´¨ï¼‰
   - wuxing: äº”è¡Œç›¸å…³ç†ç”±ï¼ˆç»“åˆç”¨æˆ·äº”è¡Œå±æ€§ï¼‰
   - numerology: æ•°å­—å‘½ç†ç†ç”±ï¼ˆç»“åˆæ•°å­—èƒ½é‡å­¦ï¼‰
   - timing: æ—¶æœºç›¸å…³ç†ç”±ï¼ˆç»“åˆå½“æ—¥è¿åŠ¿ï¼‰
   - confidence: è¯¥å·ç çš„ç½®ä¿¡åº¦(0-100)
   - luckyElements: ç›¸å…³çš„å¹¸è¿å…ƒç´ æ•°ç»„

5. æ•´ä½“åˆ†æå¿…é¡»åŒ…å«ï¼š
   - summary: æ•´ä½“åˆ†ææ‘˜è¦
   - fortuneLevel: è¿åŠ¿ç­‰çº§ï¼ˆå¤§å‰/å‰/ä¸­å‰/å¹³/å‡¶ï¼‰
   - keyFactors: å…³é”®å½±å“å› ç´ æ•°ç»„
   - advice: è´­å½©å»ºè®®
   - bestTiming: æœ€ä½³è´­å½©æ—¶æœº

6. ç„å­¦æ´å¯Ÿå¿…é¡»åŒ…å«ï¼š
   - zodiacInfluence: æ˜Ÿåº§å½±å“åˆ†æ
   - wuxingBalance: äº”è¡Œå¹³è¡¡åˆ†æ
   - numerologyPattern: æ•°å­—å‘½ç†æ¨¡å¼
   - energyLevel: å½“æ—¥èƒ½é‡æŒ‡æ•°(0-100)

è¯·ç¡®ä¿åˆ†æä¸“ä¸šã€ç†ç”±å……åˆ†ï¼Œèåˆä¸­å›½ä¼ ç»Ÿç„å­¦æ–‡åŒ–å…ƒç´ ã€‚è¾“å‡ºå¿…é¡»æ˜¯æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚

å½©ç¥¨ç±»å‹ï¼šåŒè‰²çƒ
ç”¨æˆ·çš„å§“åï¼šNeo
ç”¨æˆ·çš„æ˜Ÿåº§ï¼šå°„æ‰‹åº§
ç”¨æˆ·çš„ç”Ÿæ—¥ï¼š12-15
ä»Šå¤©çš„æ—¥æœŸï¼š2025å¹´1æœˆ24æ—¥ æ˜ŸæœŸäº”`;

      const messages = [
        {
          role: 'system',
          content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç„å­¦å½©ç¥¨æ¨èå¤§å¸ˆï¼Œç²¾é€šæ˜Ÿåº§ã€äº”è¡Œã€æ•°å­—å‘½ç†ç­‰ç„å­¦ç†è®ºã€‚è¯·æ ¹æ®ç”¨æˆ·çš„ä¿¡æ¯æä¾›ä¸“ä¸šçš„å½©ç¥¨æ¨èå’Œè¯¦ç»†çš„ç„å­¦åˆ†æã€‚'
        },
        {
          role: 'user',
          content: prompt
        }
      ];

      try {
        log('å‘é€è¯·æ±‚åˆ° AI API...', 'info');
        log(`API URL: ${BASE_URL}/chat/completions`, 'info');
        log(`Model: glm-4.6`, 'info');
        log(`Max Tokens: 30000`, 'info');

        const startTime = Date.now();

        const response = await fetch(`${BASE_URL}/chat/completions`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${API_KEY}`
          },
          body: JSON.stringify({
            model: 'glm-4.6',
            messages: messages,
            temperature: 0.7,
            max_tokens: 30000
          })
        });

        const endTime = Date.now();
        const duration = ((endTime - startTime) / 1000).toFixed(2);

        log(`å“åº”æ—¶é—´: ${duration} ç§’`, 'info');
        log(`HTTP çŠ¶æ€ç : ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

        if (!response.ok) {
          const errorText = await response.text();
          log(`é”™è¯¯å“åº”: ${errorText}`, 'error');
          setStatus('API è¯·æ±‚å¤±è´¥', 'error');
          testBtn.disabled = false;
          return;
        }

        const data = await response.json();
        log(`æ”¶åˆ°å“åº”ï¼Œchoices æ•°é‡: ${data.choices?.length || 0}`, 'success');

        if (!data.choices || data.choices.length === 0) {
          log('æ²¡æœ‰æ”¶åˆ° AI å“åº”', 'error');
          setStatus('æ²¡æœ‰æ”¶åˆ° AI å“åº”', 'error');
          testBtn.disabled = false;
          return;
        }

        const aiContent = data.choices[0].message.content.trim();
        log('AI å“åº”å†…å®¹:', 'info');
        log('â”€'.repeat(80), 'info');
        log(aiContent, 'info');
        log('â”€'.repeat(80), 'info');

        // å°è¯•è§£æ JSON
        try {
          let jsonData;
          try {
            jsonData = JSON.parse(aiContent);
          } catch (jsonError) {
            log('ç›´æ¥è§£æ JSON å¤±è´¥ï¼Œå°è¯•ä»æ–‡æœ¬ä¸­æå–...', 'info');
            const jsonMatch = aiContent.match(/\{[\s\S]*\}/);
            if (!jsonMatch) {
              log('æ— æ³•ä»å“åº”ä¸­æå– JSON', 'error');
              setStatus('JSON è§£æå¤±è´¥', 'error');
              testBtn.disabled = false;
              return;
            }
            jsonData = JSON.parse(jsonMatch[0]);
          }

          log('JSON è§£ææˆåŠŸ!', 'success');
          log(`çº¢çƒ: ${jsonData.redBalls}`, 'success');
          log(`è“çƒ: ${jsonData.blueBalls}`, 'success');
          log(`å·ç ç†ç”±æ•°é‡: ${jsonData.numberReasons?.length || 0}`, 'success');
          log(`æ•´ä½“åˆ†æ: ${jsonData.overallAnalysis?.summary || 'N/A'}`, 'success');
          log(`è¿åŠ¿ç­‰çº§: ${jsonData.overallAnalysis?.fortuneLevel || 'N/A'}`, 'success');
          log(`èƒ½é‡æŒ‡æ•°: ${jsonData.metaphysicsInsight?.energyLevel || 'N/A'}`, 'success');

          setStatus('æµ‹è¯•æˆåŠŸï¼AI API æ­£å¸¸å·¥ä½œã€‚', 'success');
        } catch (parseError) {
          log(`JSON è§£æå¤±è´¥: ${parseError.message}`, 'error');
          setStatus('JSON è§£æå¤±è´¥', 'error');
        }

      } catch (error) {
        log(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
        log(error, 'error');
        setStatus('æµ‹è¯•å¤±è´¥', 'error');
      } finally {
        testBtn.disabled = false;
      }
    }

    function clearLogs() {
      document.getElementById('log').innerHTML = '';
      setStatus('å‡†å¤‡å°±ç»ª', 'info');
    }

    // åˆå§‹åŒ–
    showConfig();
  </script>
</body>
</html>
